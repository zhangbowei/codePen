<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .container input {
            width: 50px;
        }
    </style>
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div id="box" class="container">
    </div>
    <script>
        var dataList = [20, 40, 90, 45, 1, 1, 1, 1, 1, 1];
        var box = document.querySelector('#box');
        dataList.forEach(function (item) {
            var node = document.createElement('input');

            node.value = item;
            node.type = 'button';
            box.appendChild(node);
        });

        var nodes = document.querySelectorAll('input');
        Array.from(nodes).sort(function (a, b) {
            return a.value - b.value;
        }).forEach(function (node) {
            box.appendChild(node);
        });

        // function go(node) {
        //     async function tic() {
        //         await sleep(1000);
        //         if (--node.value !== 0) {
        //             return tic();
        //         }
        //     }

        //     var sleep = (delay) => new Promise((res) => setTimeout(res, delay));

        //     if (node.dataset.start === void 0) {
        //         node.dataset.start = true;
        //         tic();
        //     }
        // }

        function go(node) {
            function getTic(delay) {
                return () => new Promise((res) => {
                    setTimeout(function () {
                        --node.value !== 0 ? res() : null;
                    }, delay);
                });
            }

            var tic = getTic(1000);
            var step = () => tic().then(step);

            if (node.dataset.start === void 0) {
                node.dataset.start = true;
                step();
            }
        }

        function debounce(callbackFn, delay) {
            var timer;

            return function () {
                if (timer) {
                    clearTimeout(timer);
                }

                var self = this;
                var args = arguments;

                timer = setTimeout(function() {
                    callbackFn.apply(self, args);
                }, delay);
            }
        }

        box.onclick = debounce(function (e) {
            var node = e.target;
            while (node !== box) {
                if (node.tagName.toLowerCase() === 'input') {
                    break;
                }
                node = node.parentNode;
            }
            console.log(this === e.currentTarget);
            go(node);
        }, 1000);
    </script>

</body>

</html>